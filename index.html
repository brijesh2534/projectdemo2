<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nifty 50 Top Gainers</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <div class="container my-5">
        <h2 class="text-center mb-4">Nifty 50 Stocks - Top Gainers (Pre-market)</h2>
        <p class="text-center" id="lastUpdated"></p>
        <table class="table table-striped table-hover">
            <thead>
                <tr>
                    <th>Stock Symbol</th>
                    <th>Company Name</th>
                    <th>Last Price</th>
                    <th>% Change</th>
                </tr>
            </thead>
            <tbody id="stockData">
                <tr>
                    <td colspan="4" class="text-center">Loading...</td>
                </tr>
            </tbody>
        </table>
    </div>

    <script>
        function fetchStockData() {
            $.ajax({
                url: 'https://www.nseindia.com/api/equity-stockIndices?index=NIFTY%2050',
                method: 'GET',
                headers: {
                    'User-Agent': 'Mozilla/5.0',
                    'Accept': 'application/json, text/plain, */*',
                    'X-Requested-With': 'XMLHttpRequest'
                },
                success: function(data) {
                    const stocks = data.data.filter(stock => stock.pChange > 0); // Filter top gainers
                    stocks.sort((a, b) => b.pChange - a.pChange); // Sort by percentage change
                    $('#stockData').empty(); // Clear loading message

                    stocks.slice(0, 10).forEach(stock => {
                        const row = `
                            <tr>
                                <td>${stock.symbol || 'N/A'}</td>
                                <td>${stock.companyName || stock.symbol}</td>
                                <td>â‚¹${stock.lastPrice || 'N/A'}</td>
                                <td>${stock.pChange || 'N/A'}%</td>
                            </tr>
                        `;
                        $('#stockData').append(row);
                    });

                    $('#lastUpdated').text("Last Updated: " + new Date().toLocaleString());
                },
                error: function(xhr, status, error) {
                    $('#stockData').html('<tr><td colspan="4" class="text-center">Error fetching data. Please try again later.</td></tr>');
                    console.error("Error fetching stock data:", error);
                }
            });
        }

        // Fetch stock data on page load and every 30 seconds
        fetchStockData();
        setInterval(fetchStockData, 30000);
    </script>
</body>
</html>
